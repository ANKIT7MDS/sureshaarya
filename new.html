<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Karyakram Dashboard â€“ Final Unified</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

<style>
:root{--bg:#0b0c10;--panel:#1f2833;--pri:#66fcf1;--sec:#45a29e;--muted:#c5c6c7}
*{box-sizing:border-box}
body{margin:0;font-family:Poppins,'Noto Sans Devanagari';background:var(--bg);color:#fff;height:100vh;display:flex;overflow:hidden}

/* Sidebar */
.sidebar{width:80px;background:var(--panel);display:flex;flex-direction:column;align-items:center;padding-top:15px;transition:.3s}
.sidebar:hover{width:200px}
.nav-item{width:100%;padding:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--muted)}
.sidebar:hover .nav-item{justify-content:flex-start;padding-left:20px}
.nav-item i{font-size:22px;min-width:40px}
.nav-text{display:none}
.sidebar:hover .nav-text{display:block}
.nav-item.active{color:var(--pri);background:rgba(102,252,241,.1);border-left:4px solid var(--pri)}

/* Main */
.main{flex:1;display:flex;flex-direction:column}

/* Top bar */
.top{display:flex;gap:10px;align-items:center;padding:10px 20px;background:rgba(31,40,51,.85)}
select,input,button{background:#0003;color:#fff;border:1px solid var(--sec);border-radius:20px;padding:7px 12px;font-family:inherit}
button{cursor:pointer}
button:hover{background:var(--pri);color:#000}

/* Views */
.view{flex:1;display:none;overflow:auto}
.view.active{display:flex}

/* Slides */
#slideView{justify-content:center;align-items:center}
.slide{width:100%;height:100%;display:flex;gap:20px;padding:30px}
.info{flex:1;background:var(--panel);border-radius:16px;padding:25px}
.info h2{margin-top:0;color:var(--pri)}
.photos{flex:1;display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.photos img{width:100%;height:100%;object-fit:cover;border-radius:10px}

/* Slide Modes */
.mobile-slide .slide{flex-direction:column}
.mobile-slide .photos{grid-template-columns:1fr;height:260px}
.tv-slide .slide{flex-direction:column}
.tv-slide .photos{grid-template-columns:repeat(4,1fr);height:320px}

/* Grid */
#gridView{padding:20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}
.grid-item{background:var(--panel);border-radius:12px;overflow:hidden;cursor:pointer}
.grid-item img{width:100%;height:150px;object-fit:cover}
.grid-info{padding:10px;font-size:13px}

/* Printable */
#printable{display:none}

@media print{
body>*{display:none!important}
#printable{display:block!important;background:#fff;color:#000;font-family:'Noto Sans Devanagari'}
.print-page{page-break-after:always;padding:30px}
.print-title{font-size:22px;font-weight:700;border-bottom:2px solid #45a29e;margin-bottom:15px}
.print-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;align-items:start}
.print-item{line-height:1.6}
.print-photos{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:15px}
.print-photos img{width:100%;height:200px;object-fit:cover;border:1px solid #ccc}
}
@media print and (max-width:768px){
.print-grid,.print-photos{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="sidebar">
  <div class="nav-item active" onclick="showView('slide')"><i class='bx bx-slideshow'></i><span class="nav-text">Slides</span></div>
  <div class="nav-item" onclick="showView('grid')"><i class='bx bx-grid'></i><span class="nav-text">Gallery</span></div>
</div>

<div class="main">

<div class="top">
  <select id="pdfStyle">
    <option value="A">PDF Style A</option>
    <option value="B">PDF Style B</option>
    <option value="C">PDF Style C</option>
  </select>

  <select id="slideStyle" onchange="applySlideStyle()">
    <option value="normal">Slide Normal</option>
    <option value="mobile">Slide Mobile</option>
    <option value="tv">Slide TV</option>
  </select>

  <button onclick="printPDF()">Print / PDF</button>
</div>

<div id="slideView" class="view active">
  <div id="slideBox"></div>
</div>

<div id="gridView" class="view"></div>

</div>

<div id="printable"></div>

<script>
/* ===== GOOGLE SHEET CONFIG ===== */
const SHEET_ID='1wyr0gt061UT5IVxT1JBYUEUJw1GYcBpzxDKEQmvcXXY';
const GID='1839722438';
const SHEET_URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;

/* ===== STATE ===== */
let data=[];

/* ===== HELPERS ===== */
const img=id=>`https://drive.google.com/uc?export=view&id=${id}`;

/* ===== FETCH DATA ===== */
fetch(SHEET_URL).then(r=>r.text()).then(t=>{
const j=JSON.parse(t.substring(47).slice(0,-2));
data=j.table.rows.map(r=>{
const c=r.c||[];
let photos=[];
for(let i=6;i<c.length;i++){
if(c[i]&&c[i].v){
const ids=String(c[i].v).match(/[-\w]{25,}/g);
if(ids)photos.push(...ids);
}}
return{
date:c[1]?.f||c[1]?.v||'',
district:c[2]?.v||'',
event:c[3]?.v||'',
attendance:parseInt(c[4]?.v)||0,
guests:c[5]?.v||'',
photos
};
}).filter(x=>x.event);
renderSlides();renderGrid();
});

/* ===== RENDER SLIDES ===== */
function renderSlides(){
const b=document.getElementById('slideBox');b.innerHTML='';
data.forEach(d=>{
b.innerHTML+=`
<div class="slide">
  <div class="info">
    <h2>${d.event}</h2>
    <p>ğŸ“… ${d.date}</p>
    <p>ğŸ“ ${d.district}</p>
    <p>ğŸ‘¥ ${d.attendance}</p>
    <p>ğŸ¤ ${d.guests}</p>
  </div>
  <div class="photos">
    ${d.photos.slice(0,4).map(p=>`<img src="${img(p)}">`).join('')}
  </div>
</div>`;
});
}

/* ===== GRID ===== */
function renderGrid(){
const g=document.getElementById('gridView');g.innerHTML='';
data.forEach(d=>{
g.innerHTML+=`
<div class="grid-item" onclick="showView('slide')">
  <img src="${img(d.photos[0]||'')}">
  <div class="grid-info">${d.event}<br>${d.district}</div>
</div>`;
});
}

/* ===== VIEW SWITCH ===== */
function showView(v){
document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
document.getElementById(v+'View').classList.add('active');
}

/* ===== SLIDE STYLE ===== */
function applySlideStyle(){
document.body.classList.remove('mobile-slide','tv-slide');
const v=document.getElementById('slideStyle').value;
if(v==='mobile')document.body.classList.add('mobile-slide');
if(v==='tv')document.body.classList.add('tv-slide');
}

/* ===== PDF PRINT ===== */
function printPDF(){
const p=document.getElementById('printable');p.innerHTML='';
data.forEach(d=>{
p.innerHTML+=`
<div class="print-page">
  <div class="print-title">${d.event}</div>
  <div class="print-grid">
    <div>
      <div class="print-item"><b>Date:</b> ${d.date}</div>
      <div class="print-item"><b>District:</b> ${d.district}</div>
    </div>
    <div>
      <div class="print-item"><b>Attendance:</b> ${d.attendance}</div>
      <div class="print-item"><b>Guests:</b> ${d.guests}</div>
    </div>
  </div>
  <div class="print-photos">
    ${d.photos.slice(0,4).map(p=>`<img src="${img(p)}">`).join('')}
  </div>
</div>`;
});
setTimeout(()=>window.print(),500);
}

/* Mobile auto */
if(innerWidth<768)document.body.classList.add('mobile-slide');
</script>

</body>
</html>
